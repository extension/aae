<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>eXtension: Ask an Expert</title>
	<%= javascript_include_tag "application" %>
	<%= stylesheet_link_tag    "public", :media => "all" %>
	<style type="text/css" media="screen">
		body {background:none;}
		.feedback-block {background: #e5e5e5; padding:.5em 1em; margin:1em;}
		.feedback-block.warning {background:yellow;}
		.feedback-block.notice {background:#5cb85c; color:#fff;}
		.well {margin-bottom:0;}
		.aae-logo {padding:10px; background-color:#fff;}
		#app_location {background: yellow; padding: 1em; margin-bottom: 1em;}
	</style>
</head>

<body>

    <%= form_for @question, :html => {:multipart => true, :id => "myForm", :class => "form-stacked no_m_t well"} do |f| %>
    <%= hidden_field_tag(:fingerprint, @group.widget_fingerprint) %>
		<%= hidden_field_tag(:widget_type, "js_widget") %>
		<%= hidden_field_tag(:widget_parent_url, @widget_parent_url) %>

		<p class="aae-logo"><%= image_tag "aae_logo_small.png", :class => "hidden-xs", :alt => "eXtension" %><%= image_tag "aae_logo_mobile.png", :class => "visible-xs", :alt => "eXtension" %></p>

		<%- if (Settings.app_location == 'demo') || (Settings.app_location == 'dev') %>
			<div id="app_location" class="demo">
				<p>You are viewing a <strong><%= Settings.app_location.upcase %></strong> Question form. Questions submitted here <strong>will not be answered</strong>. The owner of this page needs to update to the live Question form.</p>
			</div>
		<% end %>

    <% flash_names = [:notice, :warning, :message, :error]
          flash_names.each do |flash_type|
             if flash[flash_type] %>
                <div class='feedback-block <%= flash[:notice]? "notice" : "warning" %>'>
                    <p><%= flash[flash_type] %></p>
                </div>
            <% end %>
    <% end %>

		<p>
			<%= f.label :title, 'Give your question a title' %>
			<%= f.text_field :title, {:maxlength => Question::TITLE_MAX_LENGTH, :type => "text", :class => "form-control required"} %>
		</p>

		<p>
			<%= f.label :body, "Question  #{@group.is_australian? ? "(Please include your location: region or town)" : ""}" %>
			<%= f.text_area :body, :rows => 6, :class => "form-control required wysiwyg" %>
		</p>


    <% if @group.widget_show_location %>
        <p>
          <label>Location and County
            <%= f.select(:location_id, options_for_select(get_location_options, current_location.present? ? current_location.id : @group.widget_location_id)) %>
          </label>
        </p>

        <p id="county_list">
          <% if (current_location && current_location.counties.size > 0 ) || (@group.widget_location &&  @group.widget_location.counties.size > 0) %>
            <label>
              	<%= f.select(:county_id,
                options_for_select(get_county_options(current_location || @group.widget_location), current_county.present? ? current_county.id : @group.widget_county_id)) %>
            </label>
          <% end %>
        </p>
    <% end %>

    <% if @group.widget_upload_capable? %>
      <p>
      <label>Image (optional)</label>
      <p><em>You can upload .jpg .png or .gif.</em></p>

      <%= f.fields_for :images do |image_form| %>
          <p>
            <%= image_form.file_field :attachment %>
          </p>
      <% end %>
      </p>
    <% end %>

    <br />

    <%- if !current_user or !current_user.email.present? -%>
    <p>
        <label for="email">Email
        <%= f.text_field(:submitter_email, { :type => "email", :autocapitalize => "off" }) %>
        </label>
    </p>
    <%- end -%>


    <% if @group.widget_public_option %>

				<div class="checkbox">
         <label for="is_public">
         <%= check_box_tag :is_public, "1", false, :class => "checkbox" %>
         Share my question on Ask an Expert
  	      <span class="help-block">Sharing your question may help others learn from the answer.</span>
         </label>
			</div>
     <% end %>

     <% if @group.is_australian? %>
       <p>
         <label><input type="checkbox" id="policy-content" class="checkbox" value="consent"> I consent to any personal information which I submit in this form being disclosed and stored as detailed below</label>
       </p>
     <% end %>


     <%- if current_user and current_user.email.present? -%>
        <p>Your answer will be sent to <%= current_user.email %></p>
      <% end %>

		<p><%= submit_tag "Submit your Question", :id => "ask_submit", :data_disable_with => "Submitting...", :class => "btn btn-primary btn-orange btn-lg" %></p>

    <% if @group.is_australian? %>
     <p class="text-muted text-italic text-legal"><small>The email address you provide and any other personal information you include in your question will be stored with eXtension. eXtension is a non-profit service hosted in the United States of America. Australian parties will handle your personal information with the <%= link_to "eXtensionAUS privacy policy", "http://www.extensionaus.com.au/privacy/", :target => "_blank" %>. eXtension in the United States will handle your personal information in accordance with the <%= link_to "eXtension privacy policy", "http://www.extension.org/main/privacy", :target => "_blank" %>.</small></p>
		<% else %>
			<p class="text-muted text-italic text-legal"><small>By submitting a question, you agree to the eXtension <%= link_to "Terms of Use", "http://www.extension.org/main/termsofuse", :target => "_blank" %>.</small></p>
    <% end %>

    <% end %>

    <script class="code" type="text/javascript">
      $(document).ready(function () {





        <% if @group.is_australian? %>
          $('#ask_submit').prop('disabled', true);
          $("#policy-content").on("change", function(e){
            if($('#policy-content').prop("checked")) {
              $('#ask_submit').prop('disabled', false);
            } else {
              $('#ask_submit').prop('disabled', true);
            }
          });
        <% end %>


        $("#question_location_id").change(function() {
          var location_id = $('select#question_location_id :selected').val();
          if(location_id == "") {
            $("#county_list").html("");
          } else {
            jQuery.get('/widget/get_counties/' + location_id, function(data){
                $("#county_list").html(data);
            })
          }
          return false;
        });
      });
    </script>

</body>
</html>
