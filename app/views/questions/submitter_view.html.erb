<% @title_tag = "Ask an Expert Question - #{@question.title}"%>

<div id="public_aae">
    <h1>Your Question</h1>
    
    <br /><br />
    <div id="primary">
        <div id="question_area">
          <div class="question"><%= format_text_for_display(@question.body) %></div>
            <% @question.images.each do |image| %>
              <% if File.exists?(Rails.root.join("public#{image.url(:original,false)}")) %>
                <a data-toggle="modal" href="#myModal<%= image.id %>"><%= image_tag image.url(:thumb) %></a>
                <div id="myModal<%= image.id %>" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	            <div class="modal-header">
                <p>
                <strong><a href="#" type="button" data-dismiss="modal" aria-hidden="true">Close</a></strong> -
                <%= link_to "View full size in a new window", image.url(), :target => "_blank" %>
                <p>
                </div>
                <div class="modal-body">
                    <%= image_tag image.url() %>
                  </div>
                </div>
               <% elsif image.persisted? %>
                 <%= image_tag("missing_image.png", :size => "80x80", :class => 'missing_image') %>
               <% end %>
			<% end %>

			<% if @question.current_response.blank? %>
			    <p class="inc_descriptive editpitch">
			    <%= link_to_function 'Edit my question', "$('#edit_question').toggle();" %>.
			                  Need to clarify or correct any information? Your question is editable until one of our experts responds. Thanks!
			    </p>
			
			    <div id="edit_question" style="display:none">
				  <%= form_for @question do |f| %>
				      <%= f.text_area :body, :rows => "10", :cols => "60" %>
					  <div id="aae_image_div">
						<h3>Images</h3>
				        <p>You can include up to 3 images:</p>
				        <p><em>You can upload .jpg .png or .gif. Max size of 5MB each.</em></p>
						<% @question.images.each do |image| %>
						  <%= f.fields_for :images, image do |image_fields| %>
						    <% if image.persisted? %>
						      <p>
						      Delete <%= image_fields.check_box :_destroy %> 
						      <%= image_tag image.url(:thumb) %>
						      </p>
		                    <% else %>
		                      <p>
							    <%= image_fields.file_field :attachment  %>
							  </p>
		                    <% end %>
						  <% end %>
						<% end %>
					  </div>
					  		
				      <%= submit_tag "Save changes" %>    
				      <%= link_to_function "Cancel", "$('#edit_question').hide()" %>
				      </p>
				  <% end %>
				</div>
			<% else %>
			  <div id="responses">
			    <% if @question.responses.length > 0 %>
			        <h3>Responses:</h3>
			        <% @question.responses.each do |response| %> 
			            <div class="commentblock <%= (response.submitter.present? && response.submitter.kind == 'PublicUser') ? "public": "expert" %>" >
			              <div class="comment_wrapper">
			                <%= format_text_for_display(response.body) %>
			                <% response.images.each do |image| %>
                        <% if File.exists?(Rails.root.join("public#{image.url(:original,false)}")) %>
                        <%= button_to "Delete", remove_image_response_path(:id => response.id, :image_id => image.id) %>
                        <a data-toggle="modal" href="#myModal<%= image.id %>"><%= image_tag image.url(:thumb) %></a>

                        <div id="myModal<%= image.id %>" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                          <div class="modal-header">
                          <p>
                            <strong><a href="#" type="button" data-dismiss="modal" aria-hidden="true">Close</a></strong> -
                            <%= link_to "View full size in a new window", image.url(), :target => "_blank" %>
                          <p>
                            </div>
                          <div class="modal-body">
                            <%= image_tag image.url() %>
                          </div>
                        </div>
                        <% else %>
                          <%= image_tag("missing_image.png", :size => "80x80", :class => 'missing_image') %>
                        <% end %>
                      <% end %>
			                <%= response.signature.present? ? response.signature : '' %>
			                <p class="meta">Posted <%= time_ago_in_words(response.created_at) %> ago</p>
			               </div>
			            </div>
			        <% end %>
			    <% end %>
			  </div>
			 <% end %>
        </div>
        </div>

        <br /><br />
        <p class="inc_descriptive">This question was submitted <%= time_ago_in_words(@question.created_at) %> ago.</p>
    
        <% if @question.current_response.blank? %>
            <div id="no_answer">
                <h2>We don’t have an answer for you yet...</h2>
                <p>As soon as we have one, we’ll send you an email.</p>
                <h3>Need to clarify or correct any information?</h3>
                <p>Your question is editable until one of our experts responds. Click the "Edit my question" link above.</p>
            </div>
        <% end %>


        <% if @question_responses.length > 0 %>
		    <h3><%= link_to_function 'Add a comment', "$('#additional_comment').toggle();" %> or <%= link_to 'Ask a new question', ask_url %></h3>
		    <div id="additional_comment" style="display:none;">
		    <%= form_for @response do |r_form| %>
		        <%= r_form.text_area :body, :cols => "20", :rows => "3" %>
		        <%= hidden_field_tag :question_id, @question.id %>
                <h3>Images</h3>
		        <p>You can include up to 3 images:</p>
		        <p><em>You can upload .jpg .png or .gif. Max size of 5MB each.</em></p>
		        <%= r_form.fields_for :images do |image_form| %>
				    <p>
				      <%= image_form.file_field :attachment %>
				    </p>
				<% end %>
		
                <%= submit_tag "Post response" %>
                <%= link_to_function "Cancel", "$('#additional_comment').hide()" %>
		    <% end %>
		    </div>
		<% end %>

		<div id="privacy_options">
		<h4>Who can see this page?</h4>
		<p>This page is private.</p>
        <p>To view this page you have to know its web address (which is not public) and the email address used to submit the question.</p>
		
        <p class="aae_pitch">Have another question? <%= link_to 'Ask one of our Experts', ask_url %></p>
 
</div>