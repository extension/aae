<h1><%= @list_title %></h1>

<p><%= link_to "See everything tagged '#{params[:q]}'", expert_home_tags_path(:name => params[:q]) %></p>

<p><a href="#expert_results">Jump to Expert results</a> <a href="#group_results">Jump to Group results</a></p>

<div class="search_section">
  <h2>Questions <small>(with '<%= params[:q] %>' in the title, question or responses.)</small></h2>
  
  <h1><%= title %></h1>

<div id="main" class="span12">
  <% if !defined?(paginate_questions) || paginate_questions != false %>
    <p>Displaying <strong><%= @questions.offset + 1 %>-<%= @questions.offset + @questions.size %> of <%= @questions.total_entries %></strong></p>
  <% end %>

  <% @questions.each do |question| %>
  <div class="incoming_question">

    <div class="row-fluid">  

      <div class="span8">
        <%= link_to expert_question_path(question.id) do %>
          <% if question.title.present? %>
            <h3><%= format_text_for_display(question.title) -%></h3>
          <% else %>
            <h3><%= format_text_for_display(question.body.truncate(80, separator: ' ')) %></h3>
          <% end %>
          <p><%= Question.html_to_pretty_text(question.body).html_safe -%></p>
        <%- end -%>
        <p>
          <% if question.location.present? %>
            <% if question.county.present? %>
              <span class="tag tag-geography"><%= link_to "#{question.county.name}", expert_view_county_path(question.county.id) %></span>
            <% end %>
            <% if question.location.present? %>
              <span class="tag tag-geography"><%= link_to question.location.abbreviation, expert_view_location_path(question.location.id) %></span>
            <% end %>
          <% else %>
            <span class="label label-inverse"><%= link_to "No Location" %></span>
          <% end %>

          <% if question.tags.size > 0 %>
            <% question.tags.each do |tag| %>
              <% if question.assigned_group %>
                <span class="label"><%= link_to tag.name, questions_by_tag_expert_groups_path(:group_id => question.assigned_group.id, :tag_id => tag.id) %></span>
              <% else %>
                <span class="label"><%= link_to tag.name, expert_home_tags_path(:name => tag.name) %></span>
              <% end %>
            <% end %>
          <% else %>
            <span class="label label-inverse"><%= link_to "needs tags", expert_question_path(question.id) %></span>
          <% end %>
            <%= time_ago_in_words(question.created_at) %> ago
        </p>
      </div>

      <div class="span4">
	    <div class="expert">
	    <% if question.assignee_id.present? %>
          <%= link_to expert_user_path(question.assignee_id) do %>
            <%= link_expert_user_avatar(question.assignee, :thumb) %> <%= link_to question.assignee.name, expert_user_path(question.assignee.id) %>
		  <% end %>
		<% else %>
		  <p><strong>This question does not have an assignee.</strong></p>
		<% end %>

		<% if question.assigned_group %>
	      <p><%= link_expert_group_avatar(question.assigned_group, :mini) %> <%= link_to question.assigned_group.name, expert_group_path(question.assigned_group.id) %></p>
		<% else %>
			<p><strong>This question is groupless</strong></p>
		<% end %>
        </div>
      </div>

    </div>

  </div>
  <% end %>
  <% if !defined?(paginate_questions) || paginate_questions != false %>
  <%= paginate @questions %>
  <% end %>
</div>

  <br class="clearing" />
</div>
